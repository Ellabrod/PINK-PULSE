<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <script>

function uploadImage() {
    // 1. Get the currently logged-in user's information.
    const user = getAuth().currentUser;

    // 2. Check if a user is logged in.
    if (user) {
        // 3. Get the unique ID (UID) of the logged-in user.
        const uid = user.uid;

        // 4. Get the image file selected by the user from the input element.
        const imageFile = document.getElementById('imageUpload').files[0];

        // 5. Check if the user has selected an image file.
        if (imageFile) {
            // 6. Create a reference to the Firebase Storage where we'll store the user's image.
            const storage = getStorage();

            // 7. Define the path in the storage where the image will be saved. We use the user's UID to make it unique.
            const imageStorageRef = storageRef(storage, 'userImages/' + uid);

            // 8. Start the process of uploading the image to Firebase Storage.
            const uploadTask = uploadBytesResumable(imageStorageRef, imageFile);

            // 9. Monitor the upload process.
            uploadTask.on('state_changed', 
                (snapshot) => {
                    // This section can be used to show the progress of the upload.
                }, 
                (error) => {
                    // If there's an error during the upload, show an alert with the error message.
                    alert('Error uploading image: ', error);
                }, 
                () => {
                    // Once the upload is complete, show a success message.
                    alert('Image uploaded successfully!');
                }
            );
        } else {
            // If no image is selected, inform the user to select one.
            alert('Please select an image to upload.');
        }
    } else {
        // If no user is logged in, inform the user.
        alert('No user is currently authenticated');
    }
}


/*
Imagine you have a digital photo album (Firebase Storage) where you want to save a picture. But before you can save a picture, you need to make sure of a few things:

Check if you're allowed to save a picture: Before you can save a picture, you need to make sure you're allowed to. This is like checking if you have the key to the photo album. If you're not logged in, you can't save a picture.

Choose a picture: You look at your computer and pick a picture you want to save. If you forget to pick a picture, the computer will remind you to choose one.

Find a spot in the album: Before you save the picture, you need to decide where in the album you'll put it. To make sure you can always find your picture, you save it in a spot labeled with your unique name (UID).

Start saving the picture: Now, you start the process of putting the picture in the album. As you're doing this, you keep an eye on the process. If something goes wrong (like the picture is too big or the album is locked), you'll get a warning. But if everything goes well, you'll get a message saying the picture was saved successfully!

That's how the uploadImage function works. It's like saving a picture in a digital photo album, making sure you have the right to do so, and keeping an eye on the process.
*/
        function FindData() {
    // 1. Create a reference to the "users" node in the Firebase Realtime Database.
    const dbref = ref(db, "users");

    // 2. Define a query to search for users by their name.
    // This query will look for entries where the "Name" child matches the value in the findName input.
    const nameQuery = query(dbref, orderByChild("Name"), equalTo(findName.value));

    // 3. Execute the query to fetch data from the database.
    get(nameQuery)
    .then((snapshot) => {
        // 4. Check if the query returned any results.
        if (snapshot.exists()) {
            // 5. Extract the data from the snapshot.
            const userData = snapshot.val();

            // 6. Get the UID (key) of the first user found. This is because multiple users might have the same name.
            const firstKey = Object.keys(userData)[0];

            // 7. Get the data of the first user found.
            const firstUser = userData[firstKey];

            // 8. Display the age of the found user in the findAge element.
            findAge.innerHTML = "Age: " + firstUser.Age;

            // 9. Create a reference to the Firebase Storage where the user's images are stored.
            const storage = getStorage();

            // 10. Define the path to the image of the found user based on their UID.
            const imagePath = 'userImages/' + firstKey;

            // 11. Create a reference to the specific image in Firebase Storage.
            const imageRef = storageRef(storage, imagePath);

            // 12. Fetch the download URL of the image to display it.
            getDownloadURL(imageRef).then((url) => {
                // 13. Display the user's image in the userImage div.
                const userImageDiv = document.getElementById('userImage');
                userImageDiv.innerHTML = `<img src="${url}" alt="User Image" width="200">`; // Adjust width as needed
            }).catch((error) => {
                // Handle any errors that occur while fetching the image.
                console.error('Error fetching image:', error);
            });

        } else {
            // If no user was found with the given name, show an alert.
            alert("No data found");
        }
    })
    .catch((error) => {
        // Handle any errors that occur while querying the database.
        alert(error);
    });
}

/*
Imagine you have a big book of users, where each user has a unique number (UID) and some information about them, like their name and age. This book is your Firebase Realtime Database.

Now, you want to find a user by their name, but the book is organized by their unique numbers, not by names. So, you need a special way to search.

First, you tell the book, "Hey, I want to look at the 'users' section."
Then, you ask the book, "Can you find me a user whose name matches this specific name I have?"
The book starts searching and gives you the information of the first user it finds with that name.
You then display the age of that user on your website.
Next, you remember that you also have a photo album (Firebase Storage) where you store pictures of each user based on their unique number.
You go to the photo album and ask, "Can you show me the picture of the user with this specific number?"
The photo album gives you the picture, and you display it on your website.
If at any point the book or the photo album can't find what you're asking for or something goes wrong, they'll let you know with an error message.
*/ 
    </script>
</body>
</html>


